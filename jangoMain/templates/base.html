<!DOCTYPE html>
<html lang="en">

  <head>

    {% block title %}
      <title>Jango Notes</title>
    {% endblock %}
    <meta charset="utf-8">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
      integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
      crossorigin="anonymous">
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
      integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
      crossorigin="anonymous"></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
      integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
      crossorigin="anonymous"></script>

    {% block head %}{% endblock head %}

    <!-- Add additional CSS in static file -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'notesApp/css/style.css' %}">
  </head>

  <body>

    <div class="container-fluid">

      <div class="row">
        <div class="col-md-2">
          {% block sidebar %}
            <nav class="navbar">
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'index' %}">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'notes' %}">All notes</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/admin">Admin Site</a>
                </li>

                {% if user.is_authenticated %}
                  <li>User:
                    {{ user.get_username }}</li>
                  <li>
                    <a href="{% url 'logout'%}?next=/accounts/logout">Logout</a>
                  </li>
                {% else %}
                  <li>
                    <a href="{% url 'login'%}?next={{request.path}}">Login</a>
                  </li>
                  <li>
                      <a href="{% url 'register'%}">Register</a>
                    </li>
                {% endif %}

              </ul>
            </nav>
          {% endblock %}
        </div>
        <div class="col-md-10">
          {% block content %}{% endblock %}
        </div>
      </div>

    </div>
  </body>

</html>

<script>
  
    function getParameterByName(name) {
      url = window.location.href;
      name = name.replace(/[\[\]]/g, "\\$&");
      var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, " "));
  }

  function updateQueryStringParameter(uri, key, value) {
    var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
    var separator = uri.indexOf('?') !== -1 ? "&" : "?";

    if (value == '') {
      return 'notes'
    }

    if (uri.match(re)) {
      if (value == getParameterByName('sort') && key == 'sort') {
        if (value.startsWith('-')) {
          value = value.replace('-', '')
        } else {
          value = `-${value}`
        }
      }

      return uri.replace(re, '$1' + key + "=" + value + '$2');
    }
    else {
      return uri + separator + key + "=" + value;
    }
  }

  function query(key, value) {
    url = window.location.href
    window.location.href = updateQueryStringParameter(url, key, value)
  }

  $(document).ready(function () {
    $('#searchInput').val(getParameterByName('search'))
  })

  $('#search').click(function() {
    query('search', $('#searchInput').val())
  })

  $('#colour').click(function() {
    query('sort', 'colour')
  })

  $('#group').click(function() {
    query('sort', 'group')
  })

  $('#dateDue').click(function() {
    query('sort', 'dateDue')
  })

</script>

{% block script %}{% endblock script %}